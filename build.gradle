plugins {
    id 'java'
    id 'application'
}

group 'com.guardsquare'
version '1.0'

java {
    toolchain {
        languageVersion.set(JavaLanguageVersion.of(8))
    }
}

repositories {
    mavenLocal()
    mavenCentral()
}

application {
    mainClassName = 'proguard.tools.KotlinMetadataPrinter'
}

jar {
    manifest {
        attributes 'Main-Class': application.mainClassName
    }
    from {
        configurations.runtimeClasspath.collect { it.isDirectory() ? it : zipTree(it) }
    }
    archiveName "kotlin-metadata-printer.jar"
    duplicatesStrategy = DuplicatesStrategy.EXCLUDE
}

dependencies {
    implementation 'com.guardsquare:proguard-core:7.0.1'

    // dex2jar dependencies.
    implementation fileTree(dir: 'libs', include: ['*.jar'])

    // TODO proguard-core:7.0.1 compiles against 0.1.0 but updating to 0.2.0 here
    //      is OK because the don't write metadata. There is a breaking change
    //      in the writers but the reader API remains the same.
    implementation "org.jetbrains.kotlinx:kotlinx-metadata-jvm:0.2.0"

    implementation group: 'org.ow2.asm', name: 'asm-debug-all', version: '5.0.3'

    // For some string utils.
    implementation group: 'org.apache.commons', name: 'commons-lang3', version: '3.0'

    // For building the JSON output.
    implementation group: 'org.json', name: 'json', version: '20190722'

    // picocli for command line parsing.
    implementation group: 'info.picocli', name: 'picocli', version: '3.6.1'
}
